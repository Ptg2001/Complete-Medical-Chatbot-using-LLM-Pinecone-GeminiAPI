<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Medical Chatbot</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: #0f172a;
        --muted: #94a3b8;
        --border: #1f2a44;
        --primary: #22c55e;
        --primary-600: #16a34a;
        --user: #2563eb;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; color: #e2e8f0; background:
        linear-gradient(rgba(7, 12, 24, 0.85), rgba(7, 12, 24, 0.92)),
        url('https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?q=80&w=1974&auto=format&fit=crop');
        background-size: cover; background-position: center; background-attachment: fixed; }
      .page { min-height: 100%; padding: 24px; display: grid; place-items: center; }
      .app { width: 100%; max-width: 960px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)), var(--card); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
      .header { padding: 20px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
      .logo { width: 44px; height: 44px; border-radius: 10px; border: 1px solid var(--border); background: #0b1224; object-fit: cover; }
      .badge { display: none; }
      .title { margin: 0; font-size: 18px; }
      .subtitle { margin: 0; font-size: 13px; color: var(--muted); }
      .body { display: grid; grid-template-rows: 1fr auto; height: 70vh; }
      .messages { padding: 20px; overflow: auto; display: flex; flex-direction: column; gap: 12px; }
      .msg { display: flex; gap: 10px; }
      .msg.user { justify-content: flex-end; }
      .avatar { flex: 0 0 36px; width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; font-size: 14px; border: 1px solid var(--border); background: #0b1224; color: #cbd5e1; }
      .bubble { max-width: min(76%, 760px); padding: 10px 12px; border-radius: 14px; border: 1px solid var(--border); line-height: 1.45; white-space: pre-wrap; word-wrap: break-word; }
      .bubble.user { background: linear-gradient(145deg, #1d4ed8, var(--user)); color: #fff; border-color: rgba(255,255,255,0.12); }
      .bubble.bot { background: rgba(255,255,255,0.03); }
      .composer { padding: 16px; border-top: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,0.015), transparent); display: grid; grid-template-columns: 1fr auto; gap: 10px; }
      .input { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border); background: #0b1224; color: #e2e8f0; outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03); }
      .input::placeholder { color: #6b7280; }
      .send { padding: 10px 16px; border-radius: 12px; border: 1px solid #14532d; background: linear-gradient(135deg, var(--primary), var(--primary-600)); color: #07130b; font-weight: 700; cursor: pointer; }
      .send:disabled { opacity: 0.6; cursor: not-allowed; }
      .typing { display: inline-flex; align-items: center; gap: 6px; color: var(--muted); }
      .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); opacity: 0.7; animation: blink 1.4s infinite ease-in-out; }
      .dot:nth-child(2) { animation-delay: 0.2s; }
      .dot:nth-child(3) { animation-delay: 0.4s; }
      @keyframes blink { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; } 40% { transform: scale(1); opacity: 1; } }
      @media (max-width: 640px) { .body { height: 78vh; } .bubble { max-width: 86%; } }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="app">
        <div class="header">
          <img class="logo" alt="Medical Logo" src="/logo.png" />
          <div>
            <h1 class="title">Medical Chatbot</h1>
            <p class="subtitle">AI assistant for concise, reliable answers</p>
          </div>
        </div>
        <div class="body">
          <div id="messages" class="messages"></div>
          <form id="form" class="composer">
            <input id="input" class="input" placeholder="Ask a medical question..." autocomplete="off" />
            <button id="send" class="send" type="submit">Send</button>
          </form>
        </div>
      </div>
    </div>
    <script>
      const elMessages = document.getElementById('messages');
      const elForm = document.getElementById('form');
      const elInput = document.getElementById('input');
      const elSend = document.getElementById('send');
      const apiBase = window.__API_BASE__ || '';

      function createAvatar(role) {
        const a = document.createElement('div');
        a.className = 'avatar';
        a.textContent = role === 'user' ? 'You' : 'AI';
        return a;
      }

      function addMessage(role, text, isTyping = false) {
        const row = document.createElement('div');
        row.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
        const bubble = document.createElement('div');
        bubble.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
        if (isTyping) {
          bubble.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';
        } else {
          bubble.textContent = text;
        }
        if (role === 'assistant') row.appendChild(createAvatar('assistant'));
        row.appendChild(bubble);
        if (role === 'user') row.appendChild(createAvatar('user'));
        elMessages.appendChild(row);
        elMessages.scrollTop = elMessages.scrollHeight;
        return bubble;
      }

      function setLoading(state) {
        elSend.disabled = state;
        elInput.disabled = state;
      }

      elForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const content = elInput.value.trim();
        if (!content) return;
        addMessage('user', content);
        elInput.value = '';
        setLoading(true);
        const typingBubble = addMessage('assistant', '', true);
        try {
          const res = await fetch(apiBase + '/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: content })
          });
          let payload = null;
          try { payload = await res.json(); } catch (_) { /* ignore */ }
          if (!res.ok) {
            const msg = payload && payload.error ? payload.error : `HTTP ${res.status}`;
            throw new Error(msg);
          }
          typingBubble.textContent = (payload && payload.answer) ? payload.answer : 'No response';
        } catch (err) {
          typingBubble.textContent = 'Error: ' + (err instanceof Error ? err.message : 'unable to fetch response.');
        } finally {
          setLoading(false);
        }
      });

      elInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          elForm.dispatchEvent(new Event('submit'));
        }
      });
    </script>
  </body>
  </html>

